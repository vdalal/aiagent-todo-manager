---
phase: 01-core-storage-task-model
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - test_storage.py
autonomous: false

must_haves:
  truths:
    - "Tasks persist to JSON and can be loaded back on subsequent runs"
    - "Week boundaries work correctly across month/year transitions"
    - "Error handling prevents crashes on corrupted/missing files"
  artifacts:
    - path: "test_storage.py"
      provides: "End-to-end integration test"
      min_lines: 30
      contains: "def test_"
  key_links:
    - from: "test_storage.py"
      to: "task.py + week_utils.py + storage.py"
      via: "imports all three modules"
      pattern: "from (task|week_utils|storage) import"
---

<objective>
Verify the storage layer works end-to-end by creating integration tests and confirming all requirements are met.

Purpose: Ensure the three foundation modules work together correctly and handle edge cases (week boundaries, file errors). This verification confirms Phase 1 requirements before Phase 2 builds CLI on top.

Output: test_storage.py with integration tests and human verification checkpoint.
</objective>

<execution_context>
@C:\Users\vdala\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\vdala\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\vdala\OneDrive\gsd\.planning\PROJECT.md
@C:\Users\vdala\OneDrive\gsd\.planning\ROADMAP.md
@C:\Users\vdala\OneDrive\gsd\.planning\REQUIREMENTS.md
@C:\Users\vdala\OneDrive\gsd\.planning\STATE.md
@C:\Users\vdala\OneDrive\gsd\.planning\phases\01-core-storage-task-model\01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Integration Test Script</name>
  <files>test_storage.py</files>
  <action>
Create test_storage.py in the project root with comprehensive tests:

1. Test task creation and serialization:
   - Create Task, verify UUID format
   - Check to_dict/from_dict round-trip
   - Verify week_start is set automatically

2. Test week boundary calculation:
   - Test dates across week (Monday through Sunday)
   - Test month boundary (e.g., Jan 31 to Feb 1)
   - Test year boundary (e.g., Dec 31 to Jan 1)
   - Verify all return correct Monday start

3. Test storage operations:
   - Create TaskStore with test file
   - Add multiple tasks
   - Load tasks back
   - Verify task count and data integrity

4. Test error handling (requirements STOR-02, STOR-03, ERR-02):
   - Delete JSON file and call load_tasks (should return empty list, not crash)
   - Create corrupted JSON file and call load_tasks (should print error message)
   - Make JSON file read-only and call save_tasks (should print permission error)

5. Run all tests and print results with clear pass/fail messages

Use Python standard library: unittest or simple assert statements with try/except.
  </action>
  <verify>
Run: python test_storage.py

Should print test results showing:
- Task creation works
- Week boundaries correct
- Storage save/load works
- Error handling works (no crashes on missing/corrupted files)
  </verify>
  <done>
test_storage.py exists and runs successfully, demonstrating all Phase 1 requirements are met.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 1 storage layer:
- Task model with auto-generated IDs (task.py)
- Week boundary calculation (week_utils.py)
- JSON persistence with error handling (storage.py)
- Integration tests (test_storage.py)
  </what-built>
  <how-to-verify>
1. Run the integration tests:
   python test_storage.py

   Expected: All tests pass showing task creation, week calculation, storage operations, and error handling work correctly.

2. Manually test task persistence:
   python -c "from storage import TaskStore; from task import Task; store = TaskStore(); store.add_task(Task('Manual test task')); print('Task saved')"

   python -c "from storage import TaskStore; tasks = TaskStore().load_tasks(); print(f'Loaded {len(tasks)} task(s): {tasks[0].text if tasks else \"none\"}')"

   Expected: Task persists to tasks.json and loads back correctly.

3. Check error handling:
   - Delete tasks.json
   - Run: python -c "from storage import TaskStore; print(TaskStore().load_tasks())"
   - Expected: Returns empty list with no crash

4. Verify requirements coverage:
   - STOR-01: Tasks persist in JSON ✓
   - STOR-02: File read errors handled ✓
   - STOR-03: File write errors handled ✓
   - TASK-01: Auto-generated IDs ✓
   - TASK-03: Week-based organization ✓
   - ERR-02: File I/O error handling ✓

5. Check all modules use Python standard library only (no external dependencies in imports)
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass and storage layer works correctly, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Integration tests run successfully demonstrating:
- Tasks are created with UUIDs
- Week boundaries calculated correctly (Monday-Sunday)
- Tasks persist to JSON file
- Tasks load back from JSON file
- File read errors handled gracefully (no crashes)
- File write errors handled gracefully (clear messages)
- No external dependencies used
</verification>

<success_criteria>
1. test_storage.py runs without errors
2. All Phase 1 requirements (STOR-01, STOR-02, STOR-03, TASK-01, TASK-03, ERR-02) are verifiable
3. Tasks successfully persist and load from JSON file
4. Week boundaries calculate correctly across date transitions
5. File errors produce clear messages without crashing
6. Human verification confirms storage layer is ready for Phase 2 CLI
</success_criteria>

<output>
After completion, create C:\Users\vdala\OneDrive\gsd\.planning\phases\01-core-storage-task-model\01-02-SUMMARY.md
</output>
