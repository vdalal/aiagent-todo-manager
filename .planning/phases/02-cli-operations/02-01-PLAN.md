---
phase: 02-cli-operations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [todo.py]
autonomous: false

must_haves:
  truths:
    - "User can add a task and it appears in the list"
    - "User can see current week's tasks with completed ones crossed off"
    - "User can mark a task complete and it appears crossed off"
    - "User can delete a task and it disappears from the list"
    - "Invalid commands show usage instructions"
    - "Invalid task IDs show clear error messages"
  artifacts:
    - path: "todo.py"
      provides: "CLI entry point with argparse and command handlers"
      min_lines: 150
  key_links:
    - from: "todo.py"
      to: "storage.TaskStore"
      via: "import and instantiate"
      pattern: "from storage import TaskStore"
    - from: "todo.py list command"
      to: "week_utils.get_week_start"
      via: "filter current week tasks"
      pattern: "get_week_start.*get_week_end"
    - from: "todo.py complete/delete commands"
      to: "task ID validation"
      via: "find task by ID with error handling"
      pattern: "task.*id.*==.*args\\.id"
---

<objective>
Create complete command-line interface for weekly task management with add, list, complete, and delete operations.

Purpose: Enable users to manage their weekly tasks from the command line using simple, intuitive commands.
Output: Working CLI (todo.py) that provides all task management operations with proper error handling and current-week filtering.
</objective>

<execution_context>
@C:\Users\vdala\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\vdala\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@C:\Users\vdala\OneDrive\gsd\.planning\PROJECT.md
@C:\Users\vdala\OneDrive\gsd\.planning\ROADMAP.md
@C:\Users\vdala\OneDrive\gsd\.planning\STATE.md
@C:\Users\vdala\OneDrive\gsd\.planning\REQUIREMENTS.md

# Phase 1 outputs (existing modules)
@C:\Users\vdala\OneDrive\gsd\task.py
@C:\Users\vdala\OneDrive\gsd\storage.py
@C:\Users\vdala\OneDrive\gsd\week_utils.py
</context>

<tasks>

<task type="auto">
  <name>Create CLI with argparse and command handlers</name>
  <files>todo.py</files>
  <action>
Create todo.py with argparse-based CLI supporting four commands: add, list, complete, delete.

**Structure:**
- Use argparse with subparsers for commands
- Each command as a separate function (add_task, list_tasks, complete_task, delete_task)
- Main function handles argparse setup and command routing

**add command:**
- Accepts task text as argument: `python todo.py add "task text"`
- Creates Task instance (auto-generates ID and assigns to current week)
- Loads existing tasks from TaskStore, appends new task, saves
- Prints confirmation with task ID
- Handles storage errors (prints error message, exits with code 1)

**list command:**
- No arguments: `python todo.py list`
- Loads tasks from TaskStore
- Filters to current week only (use get_week_start/get_week_end from week_utils)
- Displays tasks with format: `[ID] text` for incomplete, `[ID] ~~text~~` for completed
- If no tasks this week, prints "No tasks for this week"
- Handles storage errors gracefully

**complete command:**
- Accepts task ID: `python todo.py complete <id>`
- Loads tasks, finds task by ID
- If ID not found, print "Task not found: {id}" and exit with code 1 (ERR-01)
- Set task.completed = True, save tasks
- Print confirmation: "Marked complete: {task.text}"
- Handles storage errors

**delete command:**
- Accepts task ID: `python todo.py delete <id>`
- Loads tasks, finds task by ID
- If ID not found, print "Task not found: {id}" and exit with code 1 (ERR-01)
- Remove task from list, save remaining tasks
- Print confirmation: "Deleted: {task.text}"
- Handles storage errors

**Error handling:**
- Invalid command: argparse automatically shows usage help (CLI-05)
- Storage errors: Catch IOError/JSONDecodeError, print clear message, exit code 1
- Invalid IDs: Check if task exists before operating, clear error message (ERR-01)

**Use Python stdlib only:** argparse, sys. Import from task.py, storage.py, week_utils.py.

**Windows compatibility:** Use `py` command for testing (not `python`), as confirmed in Phase 1.
  </action>
  <verify>
Run basic smoke tests:
```bash
py todo.py add "Test task"
py todo.py list
py todo.py --help
```

All commands should execute without errors. List should show the added task.
  </verify>
  <done>
todo.py exists with all four command handlers, argparse setup, and error handling. Basic smoke tests pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete CLI interface with add, list, complete, delete commands and error handling.

Commands implemented:
- `py todo.py add "task text"` - Creates task for current week
- `py todo.py list` - Shows current week's tasks (completed tasks crossed off)
- `py todo.py complete <id>` - Marks task complete
- `py todo.py delete <id>` - Removes task
- Invalid commands show argparse usage help
- Invalid task IDs show "Task not found" error
  </what-built>
  <how-to-verify>
**Test all operations:**

1. **Add tasks:**
   ```bash
   py todo.py add "Buy groceries"
   py todo.py add "Write report"
   py todo.py add "Call dentist"
   ```
   Expected: Each prints confirmation with task ID

2. **List tasks:**
   ```bash
   py todo.py list
   ```
   Expected: Shows 3 tasks, all incomplete (no strikethrough)

3. **Complete a task:**
   Copy one task ID from list output, then:
   ```bash
   py todo.py complete <task-id>
   py todo.py list
   ```
   Expected: Confirmation message, then list shows that task crossed off (~~text~~)

4. **Delete a task:**
   Copy another task ID, then:
   ```bash
   py todo.py delete <task-id>
   py todo.py list
   ```
   Expected: Confirmation message, then list shows only 2 tasks remaining

5. **Test error handling:**
   ```bash
   py todo.py invalid-command
   py todo.py complete fake-id-12345
   ```
   Expected: First shows usage help, second shows "Task not found: fake-id-12345"

6. **Verify week filtering:**
   Check that list only shows current week's tasks (Monday-Sunday boundary)
   All tasks added today should appear

**Success criteria:**
- All commands work as expected
- Completed tasks display with strikethrough
- Invalid IDs show clear error messages
- Invalid commands show usage help
- Tasks persist across command invocations (check tasks.json file)
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any issues encountered.
  </resume-signal>
</task>

</tasks>

<verification>
**Phase 2 requirements coverage:**

CLI Interface:
- CLI-01: Add command implemented
- CLI-02: List command implemented
- CLI-03: Complete command implemented
- CLI-04: Delete command implemented
- CLI-05: Invalid commands show usage (argparse default)

Task Management:
- TASK-02: Completed tasks displayed with strikethrough (~~text~~)
- TASK-04: New tasks added to current week (Task auto-assigns week)
- TASK-05: List filters to current week only

Error Handling:
- ERR-01: Invalid task IDs show "Task not found" message

**Integration with Phase 1:**
- Uses TaskStore.load/save for persistence
- Uses Task class for task creation
- Uses get_week_start/get_week_end for filtering
- All Phase 1 error handling carries through (file I/O errors)
</verification>

<success_criteria>
1. User can add tasks via `py todo.py add "text"` and they appear in list
2. User can list current week's tasks via `py todo.py list`
3. Completed tasks display with strikethrough (~~text~~) in list
4. User can mark tasks complete via `py todo.py complete <id>`
5. User can delete tasks via `py todo.py delete <id>`
6. Invalid commands show argparse usage help
7. Invalid task IDs show "Task not found: {id}" error message
8. All operations persist to tasks.json via TaskStore
9. List command shows only current week's tasks (Monday-Sunday)
10. Human verification confirms all operations work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-cli-operations**/02-01-SUMMARY.md` documenting:
- CLI implementation approach (argparse + command functions)
- Week filtering logic (get_week_start/get_week_end integration)
- Error handling patterns (ID validation, storage errors)
- Human verification results
- All Phase 2 requirements satisfied
</output>
